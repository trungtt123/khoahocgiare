generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  password   String
  role       String   @default("user") // "user" or "admin"
  maxDevices Int      @default(3) // Maximum number of devices allowed
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  devices    Device[]
  videos     Video[]

  @@map("users")
}

model Device {
  id          Int      @id @default(autoincrement())
  userId      Int
  fingerprint String
  deviceInfo  String   // JSON string
  lastActive  DateTime @default(now())
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, fingerprint])
  @@index([lastActive])
  @@map("devices")
}

model Video {
  id            Int      @id @default(autoincrement())
  userId        Int
  abyssVideoId  String
  embedCode     String
  title         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("videos")
}
